<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Municipalities Database</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Municipalities Database_files/libs/clipboard/clipboard.min.js"></script>
<script src="Municipalities Database_files/libs/quarto-html/quarto.js"></script>
<script src="Municipalities Database_files/libs/quarto-html/popper.min.js"></script>
<script src="Municipalities Database_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Municipalities Database_files/libs/quarto-html/anchor.min.js"></script>
<link href="Municipalities Database_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Municipalities Database_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Municipalities Database_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Municipalities Database_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Municipalities Database_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Municipalities Database</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This notebook creates the Municipalities Database, with data from all 584 municipalities and 55 variables.</p>
<p>This takes long to run, specially loading the Census Microdata. The file with the database is uploaded on GitHub, so it’s not needed to run everything to examine the database.</p>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readxl' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mice'

The following object is masked from 'package:stats':

    filter

The following objects are masked from 'package:base':

    cbind, rbind</code></pre>
</div>
</div>
</section>
<section id="municipalities-initial-database" class="level2">
<h2 class="anchored" data-anchor-id="municipalities-initial-database">Municipalities: Initial database</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>microdatos2011 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"DataFiles/Microdatos2011/Personas/poblacion_2011_v2.sav"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> microdatos2011 <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create cusec codes of non specified municipalities (rural)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>cusec_991 <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%05d"</span>, <span class="fu">seq</span>(<span class="dv">1991</span>, <span class="dv">52991</span>, <span class="at">by =</span> <span class="dv">1000</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>cusec_992 <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%05d"</span>, <span class="fu">seq</span>(<span class="dv">1992</span>, <span class="dv">52992</span>, <span class="at">by =</span> <span class="dv">1000</span>))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>cusec_993 <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%05d"</span>, <span class="fu">seq</span>(<span class="dv">1993</span>, <span class="dv">52993</span>, <span class="at">by =</span> <span class="dv">1000</span>))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>cusec_994 <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"%05d"</span>, <span class="fu">seq</span>(<span class="dv">1994</span>, <span class="dv">52994</span>, <span class="at">by =</span> <span class="dv">1000</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>cusec <span class="ot">&lt;-</span> <span class="fu">c</span>(cusec_991, cusec_992, cusec_993, cusec_994)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>MUN_LITERAL <span class="ot">&lt;-</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">substr</span>(cusec, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="st">"91"</span>,<span class="st">"&lt;=2000"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">substr</span>(cusec, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="st">"92"</span>, <span class="st">"2001 &lt;= 5000"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">substr</span>(cusec, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="st">"93"</span>, <span class="st">"5001 &lt;= 10000"</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">substr</span>(cusec, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="st">"94"</span>, <span class="st">"10001 &lt;= 20000"</span>,<span class="st">"Otros"</span>))))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>df_rural <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(MUN_LITERAL, cusec)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Get names of municipalities and provinces</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"DataFiles/vivienda turística/exp_viv_turistica_tabla5_FEB2021.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">3</span>, <span class="at">na =</span> <span class="st">"Dato protegido por secreto estadístico."</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>nombres_municipios <span class="ot">&lt;-</span> locations <span class="sc">|&gt;</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(MUN_LITERAL, MUN) <span class="sc">|&gt;</span> </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cusec =</span> MUN) <span class="sc">|&gt;</span> </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>nombres_provincias <span class="ot">&lt;-</span> locations <span class="sc">|&gt;</span> </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PROV_LITERAL, PROV) <span class="sc">|&gt;</span> </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CPRO =</span> PROV) <span class="sc">|&gt;</span> </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(CPRO, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>nombres_municipios <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nombres_municipios, df_rural)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Get CCAA</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>ccaas <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">CodigoProvincia =</span> <span class="fu">c</span>(<span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"03"</span>, <span class="st">"04"</span>, <span class="st">"33"</span>, <span class="st">"05"</span>, <span class="st">"06"</span>, <span class="st">"08"</span>, <span class="st">"09"</span>, <span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"39"</span>, <span class="st">"12"</span>, <span class="st">"13"</span>, <span class="st">"14"</span>, <span class="st">"16"</span>, <span class="st">"17"</span>, <span class="st">"18"</span>, <span class="st">"19"</span>, <span class="st">"20"</span>, <span class="st">"21"</span>, <span class="st">"22"</span>, <span class="st">"23"</span>, <span class="st">"07"</span>, <span class="st">"24"</span>, <span class="st">"15"</span>, <span class="st">"35"</span>, <span class="st">"25"</span>, <span class="st">"26"</span>, <span class="st">"27"</span>, <span class="st">"28"</span>, <span class="st">"29"</span>, <span class="st">"30"</span>, <span class="st">"31"</span>, <span class="st">"32"</span>, <span class="st">"34"</span>, <span class="st">"36"</span>, <span class="st">"37"</span>,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="st">"38"</span>, <span class="st">"39"</span>, <span class="st">"40"</span>, <span class="st">"41"</span>, <span class="st">"42"</span>, <span class="st">"43"</span>, <span class="st">"44"</span>, <span class="st">"45"</span>, <span class="st">"46"</span>, <span class="st">"47"</span>, <span class="st">"48"</span>, <span class="st">"49"</span>, <span class="st">"50"</span>, <span class="st">"51"</span>, <span class="st">"52"</span>),</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">CCAA =</span> <span class="fu">c</span>(<span class="st">"País Vasco"</span>, <span class="st">"Castilla-La Mancha"</span>, <span class="st">"Comunidad Valenciana"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Asturias"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Extremadura"</span>, <span class="st">"Cataluña"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Extremadura"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Cantabria"</span>, <span class="st">"Comunidad Valenciana"</span>, <span class="st">"Castilla-La Mancha"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Castilla-La Mancha"</span>, <span class="st">"Cataluña"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Castilla-La Mancha"</span>, <span class="st">"País Vasco"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Aragón"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Islas Baleares"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Galicia"</span>, <span class="st">"Canarias"</span>, <span class="st">"Cataluña"</span>, <span class="st">"La Rioja"</span>, <span class="st">"Galicia"</span>, <span class="st">"Comunidad de Madrid"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Comunidad de Murcia"</span>, <span class="st">"Comunidad Foral de Navarra"</span>, <span class="st">"Galicia"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Galicia"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Canarias"</span>, <span class="st">"Cantabria"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Andalucía"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Cataluña"</span>, <span class="st">"Aragón"</span>, <span class="st">"Castilla-La Mancha"</span>, <span class="st">"Comunidad Valenciana"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"País Vasco"</span>, <span class="st">"Castilla y León"</span>, <span class="st">"Aragón"</span>, <span class="st">"Ceuta"</span>, <span class="st">"Melilla"</span>))</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Add names of provinces and municipalities</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(  </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nombres_municipios, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nombres_provincias, <span class="at">by =</span> <span class="st">"CPRO"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ccaas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CPRO"</span> <span class="ot">=</span> <span class="st">"CodigoProvincia"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(left_join(left_join(mutate(mutate(municipios, CMUN = str_pad(CMUN, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 3140101 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
</div>
</section>
<section id="rural-municipalities-recode" class="level2">
<h2 class="anchored" data-anchor-id="rural-municipalities-recode">Rural municipalities: recode</h2>
<p>Although I have data for individual municipalities from 10-20k inhabitants in 2021 I have to group them in the code 994 to compare them to 2011 data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"DataFiles/Microdatos2021/Personas/CensoPersonas_2021.RData"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>microdatos2021 <span class="ot">&lt;-</span> Microdatos</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>mun21 <span class="ot">&lt;-</span> microdatos2021 <span class="sc">|&gt;</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN) <span class="sc">|&gt;</span>    </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>mun11 <span class="ot">&lt;-</span> microdatos2011 <span class="sc">|&gt;</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN) <span class="sc">|&gt;</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># These are the municipalities lost from 2021 to 2011. </span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Municipalities from 10000 to 20000 inhabitants</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>municipios994 <span class="ot">&lt;-</span> mun21 <span class="sc">|&gt;</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(mun11, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec_994 =</span> cusec)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>mun_994 <span class="ot">&lt;-</span> municipios994 <span class="sc">|&gt;</span> </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"994"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the data of municipalities from external databases we have to group them in 991, 992, 993 and 994 according to their population. I use the 2011 population data for databases from 2011 and 2021 population data for databases from 2021, even though the differences are minimal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2011</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>poblacion_mun11 <span class="ot">&lt;-</span> <span class="fu">read_xls</span>(<span class="st">"DataFiles/Población/pobmun11.xls"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>poblacion_mun11 <span class="ot">&lt;-</span> poblacion_mun11 <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(poblacion_mun11[<span class="dv">1</span>, ]) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(MUJERES, VARONES)) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Poblacion2011 =</span> <span class="st">`</span><span class="at">AMBOS SEXOS</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>cusec_rural_2011 <span class="ot">&lt;-</span> poblacion_mun11 <span class="sc">|&gt;</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Poblacion2011 =</span> <span class="fu">as.numeric</span>(Poblacion2011)) <span class="sc">|&gt;</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Poblacion2011 <span class="sc">&lt;</span> <span class="dv">20000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec_original =</span> cusec,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      Poblacion2011 <span class="sc">&lt;</span> <span class="dv">2000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"991"</span>),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      Poblacion2011 <span class="sc">&lt;</span> <span class="dv">5000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"992"</span>),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      Poblacion2011 <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"993"</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      Poblacion2011 <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"994"</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> cusec</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>cusec_rural_2011 <span class="ot">&lt;-</span> cusec_rural_2011 <span class="sc">|&gt;</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec_original, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec_original, cusec)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 2021</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>poblacion_mun21 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Población/pobmun21.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>poblacion_mun21 <span class="ot">&lt;-</span> poblacion_mun21 <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(poblacion_mun21[<span class="dv">1</span>, ]) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(MUJERES, HOMBRES)) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Poblacion2021 =</span> <span class="st">`</span><span class="at">POB21</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>cusec_rural_2021 <span class="ot">&lt;-</span> poblacion_mun21 <span class="sc">|&gt;</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Poblacion2021 =</span> <span class="fu">as.numeric</span>(Poblacion2021)) <span class="sc">|&gt;</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Poblacion2021 <span class="sc">&lt;</span> <span class="dv">20000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec_original =</span> cusec,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      Poblacion2021 <span class="sc">&lt;</span> <span class="dv">2000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"991"</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      Poblacion2021 <span class="sc">&lt;</span> <span class="dv">5000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"992"</span>),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>      Poblacion2021 <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"993"</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      Poblacion2021 <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">~</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(cusec_original, <span class="dv">1</span>, <span class="dv">2</span>), <span class="st">"994"</span>),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> cusec</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>cusec_rural_2021 <span class="ot">&lt;-</span> cusec_rural_2021 <span class="sc">|&gt;</span> </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec_original, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec_original, cusec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="municipalities-variables" class="level1">
<h1>Municipalities variables</h1>
<p>For the component or cluster analysis of the municipalities, I prepare a table with different variables to characterize them.</p>
<ul>
<li>Percentage of population by nationality.</li>
<li>Percentage of youth residing in owned/rented/other housing.</li>
<li>Change in the percentage of youth by tenure type between 2011 and 2021.</li>
<li>Percentage of tourist housing.</li>
<li>Rental Housing Price Index in 2011 and 2021.</li>
<li>Housing Price Index (CCAA).</li>
<li>Income by municipality.</li>
<li>Percentage of young population.</li>
<li>Rural or urban municipality.</li>
<li>Percentage of vacant housing.</li>
<li>Percentage of secondary housing.</li>
<li>Mean mortgage price (Province)</li>
<li>Mean rent meter square price</li>
<li>Youth unemployement rate (CCAA)</li>
<li>Subsidized housing (CCAA)</li>
</ul>
<section id="housing-price-index" class="level3">
<h3 class="anchored" data-anchor-id="housing-price-index">Housing Price Index</h3>
<p>At CCAA level.</p>
<p>From INE https://www.ine.es/dyngs/INEbase/es/operacion.htm?c=Estadistica_C&amp;cid=1254736152838&amp;menu=ultiDatos&amp;idp=1254735976607</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ipv <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Índice precios vivienda/ipv.xlsx"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ipv2021 =</span> <span class="st">"2021T2"</span>, <span class="at">ipv2011 =</span> <span class="st">"2011T2"</span>, <span class="at">tipoipv=</span>Tipo) <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> tipoipv, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(ipv2021, ipv2011),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">"ipv2021_"</span>, <span class="st">""</span>, .x), <span class="fu">starts_with</span>(<span class="st">"ipv2021"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">"ipv2011_"</span>, <span class="st">""</span>, .x), <span class="fu">starts_with</span>(<span class="st">"ipv2011"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipv2021General =</span> ipv2021General,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipv2021Nueva =</span> <span class="st">`</span><span class="at">ipv2021Vivienda nueva</span><span class="st">`</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipv2021Segunda =</span> <span class="st">`</span><span class="at">ipv2021Vivienda segunda mano</span><span class="st">`</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipv2011General =</span> ipv2011General,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipv2011Nueva =</span> <span class="st">`</span><span class="at">ipv2011Vivienda nueva</span><span class="st">`</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipv2011Segunda =</span> <span class="st">`</span><span class="at">ipv2011Vivienda segunda mano</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CCAA =</span> <span class="fu">case_when</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Región de Murcia"</span> <span class="sc">~</span> <span class="st">"Comunidad de Murcia"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Principado de Asturias"</span> <span class="sc">~</span> <span class="st">"Asturias"</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> CCAA),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipvGeneralDif =</span> ipv2021General <span class="sc">-</span> ipv2011General)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ipv, <span class="at">by =</span> <span class="st">"CCAA"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ccaa) <span class="sc">|&gt;</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="income-per-municipality" class="level2">
<h2 class="anchored" data-anchor-id="income-per-municipality">Income per municipality</h2>
<p>I scrape the data from the web of Agencia Tributaria (Tax Agency), save it in a .csv and clean it.</p>
<p>Data from municipalities with more than 1k inhabitants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Renta por municipios/rentamunicipios.xlsx"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> renta <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MUN_LITERAL =</span>...<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(MUN_LITERAL, <span class="st">`</span><span class="at">RENTA DISPONIBLEMEDIA</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">as.character</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9]"</span>, <span class="st">""</span>, MUN_LITERAL)),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">MUN_LITERAL =</span> <span class="fu">gsub</span>(<span class="st">"[0-9-]"</span>, <span class="st">""</span>, MUN_LITERAL),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">RENTA DISPONIBLEMEDIA</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, <span class="st">`</span><span class="at">RENTA DISPONIBLEMEDIA</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(cusec) <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>MUN_LITERAL) <span class="sc">|&gt;</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">RentaMedia2021 =</span> <span class="st">`</span><span class="at">RENTA DISPONIBLEMEDIA</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">as.numeric</span>(RentaMedia2021)) <span class="sc">|&gt;</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">str_pad</span>(RentaMedia2021, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">side =</span> <span class="st">"right"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">as.numeric</span>(RentaMedia2021)) <span class="sc">|&gt;</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(cusec) <span class="sc">==</span> <span class="dv">5</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar municipios pequeños</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> renta <span class="sc">|&gt;</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">mean</span>(RentaMedia2021)) <span class="sc">|&gt;</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">..*"</span>, <span class="st">""</span>, RentaMedia2021)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="income-navarra" class="level3">
<h3 class="anchored" data-anchor-id="income-navarra">Income Navarra</h3>
<p>Average net income per person - similar to the data from Tax Agency</p>
<p>https://nastat.navarra.es/es/tablas_powerbi/-/tag/estadistica-renta</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>renta_navarra <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Renta por municipios/rentanavarra.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...2`
• `` -&gt; `...3`
• `2021` -&gt; `2021...4`
• `2021` -&gt; `2021...5`
• `2021` -&gt; `2021...6`
• `2021` -&gt; `2021...7`
• `2021` -&gt; `2021...8`
• `2021` -&gt; `2021...9`
• `2021` -&gt; `2021...10`
• `2021` -&gt; `2021...11`
• `2021` -&gt; `2021...12`
• `2021` -&gt; `2021...13`
• `2021` -&gt; `2021...14`
• `2021` -&gt; `2021...15`
• `2021` -&gt; `2021...16`
• `2021` -&gt; `2021...17`
• `2021` -&gt; `2021...18`
• `2021` -&gt; `2021...19`
• `2021` -&gt; `2021...20`
• `2021` -&gt; `2021...21`
• `2021` -&gt; `2021...22`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>renta_navarra <span class="ot">&lt;-</span> renta_navarra <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">|&gt;</span>   </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cusec =</span> <span class="st">"Año"</span>, <span class="at">RentaMedia2021 =</span> <span class="st">"2021...4"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">4</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(RentaMedia2021), <span class="dv">0</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">cusec =</span> <span class="fu">paste0</span>(<span class="st">"31"</span>, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar municipios pequeños</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>renta_navarra <span class="ot">&lt;-</span> renta_navarra <span class="sc">|&gt;</span> </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(RentaMedia2021), <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> <span class="fu">rbind</span>(renta, renta_navarra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="income-país-vasco" class="level3">
<h3 class="anchored" data-anchor-id="income-país-vasco">Income País Vasco</h3>
<p>Average available personal income https://www.eustat.eus/elementos/ele0005700/renta-personal-media-de-la-c-a-de-euskadi-por-ambitos-territoriales-segun-tipo-de-renta-euros/tbl0005790_c.html</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>renta_pv <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Renta por municipios/rentapv.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`
• `` -&gt; `...8`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>renta_pv <span class="ot">&lt;-</span> renta_pv <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>)) <span class="sc">|&gt;</span>   </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">NOMBRE =</span> <span class="st">"Renta personal media de la C. A. de Euskadi por ámbitos territoriales, según tipo de renta (euros). 2021"</span>, <span class="at">RentaMedia2021 =</span> <span class="st">"...8"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">32</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(RentaMedia2021), <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NOMBRE =</span> <span class="fu">gsub</span>(<span class="st">" / "</span>, <span class="st">"/"</span>, NOMBRE)) <span class="sc">|&gt;</span> </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NOMBRE =</span> <span class="fu">case_when</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    NOMBRE <span class="sc">==</span> <span class="st">"Leintz Gatzaga"</span> <span class="sc">~</span> <span class="st">"Leintz-Gatzaga"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    NOMBRE <span class="sc">==</span> <span class="st">"Ribera Baja/Erribera Beitia"</span> <span class="sc">~</span> <span class="st">"Erriberabeitia"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> NOMBRE))</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Añadir cusec a todos los municipios vascos </span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>renta_pv <span class="ot">&lt;-</span> renta_pv <span class="sc">|&gt;</span> </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(poblacion_mun21, NOMBRE, cusec), <span class="at">by =</span> <span class="st">"NOMBRE"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RentaMedia2021)) <span class="sc">|&gt;</span> </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>NOMBRE)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar municipios pequeños</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>renta_pv <span class="ot">&lt;-</span> renta_pv <span class="sc">|&gt;</span> </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">RentaMedia2021 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(RentaMedia2021), <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> <span class="fu">rbind</span>(renta, renta_pv)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(renta, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="of-young-population" class="level3">
<h3 class="anchored" data-anchor-id="of-young-population">% of Young Population</h3>
<p>Younger than 35 years old. As a note, the microdata is a sample of 10%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>poblacion2021 <span class="ot">&lt;-</span> microdatos2021 <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, VAREDAD) <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Población2021 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>poblacion2021 <span class="ot">&lt;-</span>  poblacion2021 <span class="sc">|&gt;</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VAREDAD <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> VAREDAD <span class="sc">&lt;=</span> <span class="dv">35</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(PoblaciónJoven2021 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PorcentajeJoven2021 =</span> <span class="fu">round</span>((PoblaciónJoven2021 <span class="sc">/</span> Población2021) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeJoven2021)    </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupar municipios pequeños</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>poblacion2021 <span class="ot">&lt;-</span>  poblacion2021 <span class="sc">|&gt;</span> </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">PorcentajeJoven2021 =</span> <span class="fu">mean</span>(PorcentajeJoven2021)) <span class="sc">|&gt;</span> </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeJoven2021 =</span> <span class="fu">round</span>(PorcentajeJoven2021, <span class="dv">2</span>))  </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 2011</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>poblacion2011 <span class="ot">&lt;-</span> microdatos2011 <span class="sc">|&gt;</span> </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, EDAD) <span class="sc">|&gt;</span> </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(Población2011 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>poblacion2011 <span class="ot">&lt;-</span>  poblacion2011 <span class="sc">|&gt;</span> </span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EDAD <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> EDAD <span class="sc">&lt;=</span> <span class="dv">35</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(PoblaciónJoven2011 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PorcentajeJoven2011 =</span> <span class="fu">round</span>((PoblaciónJoven2011 <span class="sc">/</span> Población2011) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeJoven2011)    </span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Dif</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntar datos 2021 y 2011</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>poblacion2011 <span class="ot">&lt;-</span> poblacion2011 <span class="sc">|&gt;</span> </span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poblacion2021, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear variable </span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>poblacion2011 <span class="ot">&lt;-</span> poblacion2011 <span class="sc">|&gt;</span> </span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PorcentajeJovenDif =</span> PorcentajeJoven2021 <span class="sc">-</span> PorcentajeJoven2011)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntar las 3 variables</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poblacion2011, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rural-or-urban" class="level3">
<h3 class="anchored" data-anchor-id="rural-or-urban">Rural or urban</h3>
<p>I only take into account wether the population is over or below 20k inhabitants. In some official reports from the Spanish goverments they use the same criteria (DEMOGRAFÍA DE LA POBLACIÓN RURAL del Ministerio) + population density. I use population data of 2011.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>habitat <span class="ot">&lt;-</span> microdatos2011 <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">HABITAT =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>       CMUN <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">991</span>, <span class="dv">992</span>, <span class="dv">993</span>, <span class="dv">994</span>) <span class="sc">~</span> <span class="st">"Rural"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Urbano"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(HABITAT, cusec) <span class="sc">|&gt;</span> </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(habitat, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="empty-houses" class="level3">
<h3 class="anchored" data-anchor-id="empty-houses">Empty houses</h3>
<p>In the microdata of the 2011 Census it’s very easy to find the number of empty houses per municipality, because they’re tagged as empty. However in 2021 the data only differentiates between primary and non-primary dwellings. The data for 2021 comes from this table from INE: https://www.ine.es/jaxi/Tabla.htm?tpx=59531&amp;L=0</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>vacias2021 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Vacias/vacias2021.xlsx"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>vacias2021 <span class="ot">&lt;-</span> vacias2021 <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">as.character</span>(<span class="fu">substring</span>(MUN_LITERAL, <span class="dv">1</span>, <span class="dv">5</span>)), </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MUN_LITERAL =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>, MUN_LITERAL)) <span class="sc">|&gt;</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeVacias2021 =</span> <span class="fu">round</span>((<span class="st">`</span><span class="at">Viviendas vacías</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Viviendas totales</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeVacias2021)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Group small municipalities</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>vacias2021 <span class="ot">&lt;-</span> vacias2021 <span class="sc">|&gt;</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">PorcentajeVacias2021 =</span> <span class="fu">mean</span>(PorcentajeVacias2021)) <span class="sc">|&gt;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeVacias2021 =</span> <span class="fu">round</span>(PorcentajeVacias2021, <span class="dv">2</span>)) </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 2011</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>viviendas2011 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"DataFiles/Microdatos2011/Viviendas/viviendas_2011_v1.sav"</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>vacias2011 <span class="ot">&lt;-</span> viviendas2011 <span class="sc">|&gt;</span> </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, CVIVIF) <span class="sc">|&gt;</span> </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(  </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasTotales =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CVIVIF <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasVacias2011 =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PorcentajeVacias2011 =</span> <span class="fu">round</span>((ViviendasVacias2011 <span class="sc">/</span> ViviendasTotales) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeVacias2011) <span class="sc">|&gt;</span> </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Put together both years</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>vacias <span class="ot">&lt;-</span> vacias2011 <span class="sc">|&gt;</span> </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vacias2021, <span class="at">by =</span> <span class="st">"cusec"</span>)</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create difference </span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>vacias <span class="ot">&lt;-</span> vacias <span class="sc">|&gt;</span> </span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VaciasDif =</span> PorcentajeVacias2021<span class="sc">-</span>PorcentajeVacias2011)</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vacias, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="secondary-houses" class="level3">
<h3 class="anchored" data-anchor-id="secondary-houses">Secondary houses</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2021</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>viviendas2021 <span class="ot">&lt;-</span> <span class="fu">load</span>(<span class="st">"DataFiles/Microdatos2021/Viviendas/CensoViviendas_2021.RData"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>viviendas2021 <span class="ot">&lt;-</span> Microdatos</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>secundarias2021 <span class="ot">&lt;-</span> viviendas2021 <span class="sc">|&gt;</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(CPRO, CMUN, TIPO_VIV) <span class="sc">|&gt;</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(  </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasTotales =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TIPO_VIV <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasSecundarias2021 =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeSecundarias2021 =</span> <span class="fu">round</span>((ViviendasSecundarias2021 <span class="sc">/</span> ViviendasTotales) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeSecundarias2021) <span class="sc">|&gt;</span> </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T) </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Group small municipalities</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>secundarias2021 <span class="ot">&lt;-</span> secundarias2021 <span class="sc">|&gt;</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">PorcentajeSecundarias2021 =</span> <span class="fu">mean</span>(PorcentajeSecundarias2021)) <span class="sc">|&gt;</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeSecundarias2021 =</span> <span class="fu">round</span>(PorcentajeSecundarias2021, <span class="dv">2</span>))  </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>secundarias2011 <span class="ot">&lt;-</span> viviendas2011 <span class="sc">|&gt;</span> </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, CVIVIF) <span class="sc">|&gt;</span> </span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(  </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasTotales =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CVIVIF <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasSecundarias2011 =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeSecundarias2011 =</span> <span class="fu">round</span>((ViviendasSecundarias2011 <span class="sc">/</span> ViviendasTotales) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeSecundarias2011) <span class="sc">|&gt;</span> </span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Put together both years</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>secundarias <span class="ot">&lt;-</span> secundarias2011 <span class="sc">|&gt;</span> </span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(secundarias2021, <span class="at">by =</span> <span class="st">"cusec"</span>)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create difference between years </span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>secundarias <span class="ot">&lt;-</span> secundarias <span class="sc">|&gt;</span> </span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SecundariasDif=</span>PorcentajeSecundarias2021<span class="sc">-</span>PorcentajeSecundarias2011)</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(secundarias, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="touristic-housing-in-2021" class="level3">
<h3 class="anchored" data-anchor-id="touristic-housing-in-2021">Touristic housing in 2021</h3>
<p>There’s only data for 2021. https://www.ine.es/experimental/viv_turistica/experimental_viv_turistica.htm</p>
<p>I remove NA from certain sections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>turismo <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"DataFiles/vivienda turística/exp_viv_turistica_tabla5_FEB2021.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">3</span>, <span class="at">na =</span> <span class="st">"Dato protegido por secreto estadístico."</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>turismo <span class="ot">&lt;-</span> turismo <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CPRO =</span> PROV, <span class="at">cusec =</span> MUN)<span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">PORCENTAJE VIVIENDA TURISTICA</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(PorcentajeTurísticas2021 <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">PORCENTAJE VIVIENDA TURISTICA</span><span class="st">`</span>), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeTurísticas2021) <span class="sc">|&gt;</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Group small municipalities</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>turismo <span class="ot">&lt;-</span> turismo <span class="sc">|&gt;</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(PorcentajeTurísticas2021 <span class="ot">=</span> <span class="fu">mean</span>(PorcentajeTurísticas2021)) <span class="sc">|&gt;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(PorcentajeTurísticas2021 <span class="ot">=</span> <span class="fu">round</span>(PorcentajeTurísticas2021, <span class="dv">2</span>))  </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(turismo, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="tenure-regimes-differences-between-2021-and-2011" class="level1">
<h1>Tenure Regimes differences between 2021 and 2011</h1>
<p>Using ALL OWNERSHIP data and target population</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select variables 2011</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> microdatos2011 <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, EDAD, ANAC, NORDEN, ANORES, TENEN, OPA_NORDEN, TIPOPER, ESTHOG, EDADPAD, EDADMAD) </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter target population</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EDAD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>), <span class="co"># Young people</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>         TIPOPER <span class="sc">!=</span> <span class="st">"H"</span>, <span class="co"># That aren't "child" in the household</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">is.na</span>(EDADPAD), <span class="co"># Don't live with the father</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">is.na</span>(EDADMAD)) <span class="sc">|&gt;</span> <span class="co"># Don't live with the mother </span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>EDADPAD, <span class="sc">-</span>EDADMAD) <span class="sc">|&gt;</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ESTHOG <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">01</span>, <span class="dv">02</span>, <span class="dv">05</span>, <span class="dv">07</span>, <span class="dv">08</span>, <span class="dv">10</span>, <span class="dv">11</span>)) <span class="co"># Isn't a home with only a person over 65+ neither children over 25</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mayor =</span> <span class="fu">ifelse</span>(ANORES <span class="sc">-</span> ANAC <span class="sc">&gt;</span> <span class="dv">18</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mayor <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="co"># Was of legal age when they last moved </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NORDEN <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># Position in the household is 1 or 2</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode tenure regime variable</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span>  </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">TENEN_r =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>      TENEN <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Propiedad por compra, pagada"</span>,</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>      TENEN <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Propiedad por compra, pagos pendientes"</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>      TENEN <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Propiedad por herencia o donación"</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>      TENEN <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Alquiler"</span>,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>      TENEN <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Cedida o a bajo precio"</span>,</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>      TENEN <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Otro"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">TENEN_VIV =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>      TENEN_r <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Propiedad por compra, pagada"</span>, <span class="st">"Propiedad por compra, pagos pendientes"</span>) <span class="sc">~</span> <span class="st">"Compra"</span>,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>      TENEN_r <span class="sc">==</span> <span class="st">"Propiedad por herencia o donación"</span> <span class="sc">~</span> <span class="st">"Herencia o donación"</span>,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>      TENEN_r <span class="sc">==</span> <span class="st">"Alquiler"</span> <span class="sc">~</span> <span class="st">"Alquiler"</span>,</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>      TENEN_r <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cedida o a bajo precio"</span>, <span class="st">"Otro"</span>) <span class="sc">~</span> <span class="st">"Otro"</span>))</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cusec</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span>  </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(  </span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO),</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN),</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2021</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> microdatos2021 <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, VAREDAD, ANAC, TENEN_VIV, NORDEN, RESI_NACIM, VARANORES, VARANOM, CMUN_ANT, CMUN_UNANO, RESI_UNANO, CMUN_DANO, RESI_DANO, LTRAB, CMUN_TRAB, LEST, CMUN_EST, NORDEN_CON, NORDEN_OPA, TIPOPER, SEXO_MAD, SEXO_PAD, ESTRUC_HOG) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VAREDAD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>), <span class="co"># Young people</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>         TIPOPER <span class="sc">!=</span> <span class="st">"H"</span>, <span class="co"># That aren't "child" in the household</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>         SEXO_PAD <span class="sc">==</span> <span class="st">"N"</span>, <span class="co"># Don't live with the father</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>         SEXO_MAD <span class="sc">==</span> <span class="st">"N"</span>) <span class="sc">|&gt;</span>  <span class="co"># Don't live with the mother </span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ESTRUC_HOG =</span> <span class="fu">as.numeric</span>(ESTRUC_HOG)) <span class="sc">|&gt;</span> </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ESTRUC_HOG <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">01</span>, <span class="dv">02</span>, <span class="dv">05</span>, <span class="dv">07</span>, <span class="dv">08</span>, <span class="dv">10</span>, <span class="dv">11</span>)) <span class="co"># Isn't a home with only a person over 65+ neither children over 25</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to have moved being at least 18 years old, in a broad way (risking including not interesting cases to avoid removing those which are interesting)</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">VARANORES_r =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>      VARANORES <span class="sc">==</span> <span class="st">"0005"</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">2015</span>),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>      VARANORES <span class="sc">==</span> <span class="st">"0004"</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">2010</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>      VARANORES <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"9999"</span>, <span class="st">"0003"</span>) <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="dv">2000</span>), </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>      VARANORES <span class="sc">==</span> <span class="st">" "</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(VARANORES)),</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANAC =</span> <span class="fu">as.numeric</span>(ANAC),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">mayor =</span> <span class="fu">ifelse</span>(VARANORES_r <span class="sc">-</span> ANAC <span class="sc">&gt;</span> <span class="dv">18</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mayor <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NORDEN <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"01"</span>, <span class="st">"02"</span>)) <span class="co"># Position 1 or 2 in the household</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode Tenure regime</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">TENEN_VIV =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>      TENEN_VIV <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Propiedad"</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>      TENEN_VIV <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Alquiler"</span>,</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>      TENEN_VIV <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Otro"</span>)) </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cusec</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add CCAA names</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>compra11<span class="ot">&lt;-</span>compra11 <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ccaas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CPRO"</span> <span class="ot">=</span> <span class="st">"CodigoProvincia"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(compra11, ccaas, by = c(CPRO = "CodigoProvincia")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 229959 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create variable of % of tenure regime per municipality</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Compra11Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Compra"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Propiedad11Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Compra"</span>, <span class="st">"Herencia o donación"</span>)) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Herencia11Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Herencia o donación"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alquiler11Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Alquiler"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Otro11Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Otro"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Per province</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CPRO) <span class="sc">|&gt;</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Compra11Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Compra"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Propiedad11Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Compra"</span>, <span class="st">"Herencia o donación"</span>)) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Herencia11Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Herencia o donación"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alquiler11Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Alquiler"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Otro11Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Otro"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Per CCAA</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>compra11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CCAA) <span class="sc">|&gt;</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">Compra11CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Compra"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">Propiedad11CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Compra"</span>, <span class="st">"Herencia o donación"</span>)) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">Herencia11CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Herencia o donación"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alquiler11CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Alquiler"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">Otro11CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Otro"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add CCAA</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>compra21<span class="ot">&lt;-</span>compra21 <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ccaas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CPRO"</span> <span class="ot">=</span> <span class="st">"CodigoProvincia"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(compra21, ccaas, by = c(CPRO = "CodigoProvincia")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 21 of `x` matches multiple rows in `y`.
ℹ Row 31 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per municipality</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Propiedad21Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Propiedad"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alquiler21Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Alquiler"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Otro21Mun =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Otro"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Per province</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CPRO) <span class="sc">|&gt;</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Propiedad21Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Propiedad"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alquiler21Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Alquiler"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Otro21Prov =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Otro"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Per CCAA</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CCAA) <span class="sc">|&gt;</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Propiedad21CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Propiedad"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Alquiler21CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Alquiler"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Otro21CCAA =</span> <span class="fu">round</span>((<span class="fu">sum</span>(TENEN_VIV <span class="sc">==</span> <span class="st">"Otro"</span>) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together small municipalities under code 994</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>compra21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Propiedad21Mun =</span> <span class="fu">round</span>(<span class="fu">mean</span>(Propiedad21Mun), <span class="dv">2</span>),</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">Alquiler21Mun =</span> <span class="fu">round</span>(<span class="fu">mean</span>(Alquiler21Mun), <span class="dv">2</span>),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">Otro21Mun =</span> <span class="fu">round</span>(<span class="fu">mean</span>(Otro21Mun), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only tenure regime variables</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tenencia11 <span class="ot">&lt;-</span> compra11 <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, CPRO, Compra11Mun, Propiedad11Mun, Herencia11Mun, Alquiler11Mun, Otro11Mun, Propiedad11Prov, Herencia11Prov, Alquiler11Prov, Otro11Prov, Propiedad11CCAA, Herencia11CCAA, Alquiler11CCAA, Otro11CCAA) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>tenencia21 <span class="ot">&lt;-</span> compra21 <span class="sc">|&gt;</span> </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, CPRO, Propiedad21Mun, Alquiler21Mun, Otro21Mun, Propiedad21Prov, Alquiler21Prov, Otro21Prov, Propiedad21CCAA, Alquiler21CCAA, Otro21CCAA) <span class="sc">|&gt;</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Join both years</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>tenencias <span class="ot">&lt;-</span> tenencia11 <span class="sc">|&gt;</span> </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tenencia21, <span class="at">by =</span> <span class="st">"cusec"</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create differences</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>tenencias <span class="ot">&lt;-</span> tenencias <span class="sc">|&gt;</span> </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">PropiedadDifMun =</span> Propiedad21Mun <span class="sc">-</span> Propiedad11Mun,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">AlquilerDifMun =</span> Alquiler21Mun <span class="sc">-</span> Alquiler11Mun,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">OtroDifMun =</span> Otro21Mun <span class="sc">-</span> Otro11Mun,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">PropiedadDifProv =</span> Propiedad21Prov <span class="sc">-</span> Propiedad11Prov,</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">AlquilerDifProv =</span> Alquiler21Prov <span class="sc">-</span> Alquiler11Prov,</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">OtroDifProv =</span> Otro21Prov <span class="sc">-</span> Otro11Prov,</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">PropiedadDifCCAA =</span> Propiedad21CCAA <span class="sc">-</span> Propiedad11CCAA,</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">AlquilerDifCCAA =</span> Alquiler21CCAA <span class="sc">-</span> Alquiler11CCAA,</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">OtroDifCCAA =</span> Otro21CCAA <span class="sc">-</span> Otro11CCAA)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>tenencias <span class="ot">&lt;-</span> tenencias <span class="sc">|&gt;</span> </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>CPRO.x, <span class="sc">-</span>CPRO.y) <span class="sc">|&gt;</span> </span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, Compra11Mun, Propiedad11Mun, Herencia11Mun, Alquiler11Mun, Otro11Mun, Propiedad21Mun, Alquiler21Mun, Otro21Mun, PropiedadDifMun, AlquilerDifMun, OtroDifMun)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tenencias, <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all=</span>T) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="nacionality" class="level3">
<h3 class="anchored" data-anchor-id="nacionality">Nacionality</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2011</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>nacionalidad2011 <span class="ot">&lt;-</span> microdatos2011 <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CMUN, NACI) <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMUN =</span> <span class="fu">str_pad</span>(CMUN, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">NACIONALIDAD =</span> <span class="fu">case_when</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      NACI <span class="sc">==</span> <span class="dv">108</span> <span class="sc">~</span> <span class="st">"Española"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>      NACI <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">102</span><span class="sc">:</span><span class="dv">199</span>) <span class="sc">~</span> <span class="st">"Europea"</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No europea"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(PorcentajeEspañola2011 <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(NACIONALIDAD <span class="sc">==</span> <span class="st">"Española"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">PorcentajeEuropea2011 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(NACIONALIDAD <span class="sc">==</span> <span class="st">"Europea"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">PorcentajeNoEuropea2011 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(NACIONALIDAD <span class="sc">==</span> <span class="st">"No europea"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeEspañola2011, PorcentajeEuropea2011, PorcentajeNoEuropea2011)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co">#2021</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>nacionalidad2021 <span class="ot">&lt;-</span> microdatos2021 <span class="sc">|&gt;</span> </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">trimws</span>(CPRO), <span class="at">CMUN =</span> <span class="fu">trimws</span>(CMUN), <span class="at">cusec =</span> <span class="fu">paste0</span>(CPRO, CMUN)) <span class="sc">|&gt;</span> </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">NACIONALIDAD =</span> <span class="fu">case_when</span>(</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>      PNACIO <span class="sc">==</span> <span class="dv">108</span> <span class="sc">~</span> <span class="st">"Española"</span>,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>      PNACIO <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">102</span><span class="sc">:</span><span class="dv">199</span>) <span class="sc">~</span> <span class="st">"Europea"</span>,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No europea"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(PorcentajeEspañola2021 <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(NACIONALIDAD <span class="sc">==</span> <span class="st">"Española"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">PorcentajeEuropea2021 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(NACIONALIDAD <span class="sc">==</span> <span class="st">"Europea"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">PorcentajeNoEuropea2021 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(NACIONALIDAD <span class="sc">==</span> <span class="st">"No europea"</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PorcentajeEspañola2021, PorcentajeEuropea2021, PorcentajeNoEuropea2021)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Group small municipalities</span></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>nacionalidad2021 <span class="ot">&lt;-</span> nacionalidad2021 <span class="sc">|&gt;</span> </span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(PorcentajeEspañola2021 <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(PorcentajeEspañola2021), <span class="dv">2</span>),</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">PorcentajeEuropea2021 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(PorcentajeEuropea2021), <span class="dv">2</span>),</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">PorcentajeNoEuropea2021 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(PorcentajeNoEuropea2021), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Join both years</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>nacionalidad <span class="ot">&lt;-</span> nacionalidad2011 <span class="sc">|&gt;</span> </span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nacionalidad2021, <span class="at">by =</span> <span class="st">"cusec"</span>)</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Create difference </span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>nacionalidad <span class="ot">&lt;-</span> nacionalidad <span class="sc">|&gt;</span> </span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(PorcentajeEspañolaDif<span class="ot">=</span>PorcentajeEspañola2021<span class="sc">-</span>PorcentajeEspañola2011,</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">PorcentajeEuropeaDif=</span>PorcentajeEuropea2021<span class="sc">-</span>PorcentajeEuropea2011,</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">PorcentajeNoEuropeaDif=</span>PorcentajeNoEuropea2021<span class="sc">-</span>PorcentajeNoEuropea2011)</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nacionalidad, <span class="at">by =</span> <span class="st">"cusec"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rent-square-meter" class="level2">
<h2 class="anchored" data-anchor-id="rent-square-meter">Rent square meter</h2>
<p>More useful than rental prices index because there isn’t an equivalent thing for Navarra and Basque country. Moreoever this has data for EVERY municipality. It’s price per constructed square meter. There’s no data for Cadiz or Murcia municipalities under 2k inhabitants.</p>
<p>https://www.mivau.gob.es/vivienda/alquila-bien-es-tu-derecho/serpavi</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>alq <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Precios alquiler/preciosalquiler.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">4</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns I want</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>alq <span class="ot">&lt;-</span> alq <span class="sc">|&gt;</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, CUMUN, LITMUN, ALQM2MES_LV_M_VC_21, ALQM2MES_LV_M_VU_21, ALQTBID12_M_VC_21, ALQTBID12_M_VU_21) <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MUN_LITERAL =</span> LITMUN,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">cusec =</span> CUMUN, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">alq_m2_mediano_vc_21 =</span> ALQM2MES_LV_M_VC_21,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">alq_m2_mediano_vu_21 =</span> ALQM2MES_LV_M_VU_21,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">alq_mediano_vc_21 =</span> ALQTBID12_M_VC_21,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">alq_mediano_vu_21 =</span> ALQTBID12_M_VU_21) <span class="sc">|&gt;</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co"># If there's data missing for the colective dwelling or unipersonal dwelling, use the same value as the one that is available. Remove rows when both are missing. </span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">alq_m2_mediano_vc_21 =</span> <span class="fu">coalesce</span>(alq_m2_mediano_vc_21, alq_m2_mediano_vu_21),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">alq_m2_mediano_vu_21 =</span> <span class="fu">coalesce</span>(alq_m2_mediano_vu_21, alq_m2_mediano_vc_21)) <span class="sc">|&gt;</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alq_mediano_vc_21 =</span> <span class="fu">coalesce</span>(alq_mediano_vc_21, alq_mediano_vu_21),</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">alq_mediano_vu_21 =</span> <span class="fu">coalesce</span>(alq_mediano_vu_21, alq_mediano_vc_21)) <span class="sc">|&gt;</span> </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(alq_mediano_vc_21) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(alq_mediano_vu_21))</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Group small municipalities</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>alq <span class="ot">&lt;-</span> alq <span class="sc">|&gt;</span> </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(alq_m2_mediano_vc_21)) <span class="sc">|&gt;</span> </span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(alq_mediano_vu_21)) <span class="sc">|&gt;</span> </span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">PrecioAlquilerM2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">c</span>(alq_m2_mediano_vc_21, alq_m2_mediano_vu_21)), <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="precio-alquiler-pv" class="level3">
<h3 class="anchored" data-anchor-id="precio-alquiler-pv">Precio alquiler PV</h3>
<p>From https://www.elankidetza.euskadi.eus/contenidos/documentacion/informe_emal_2021t4/es_def/Informe-EMAL-anual-2021_cas.pdf</p>
<p>The database is extracted from a report. There is no public database as such with the complete data from the report. That’s why the data is collected in this way. The data comes from the ‘functional areas’ of the Basque Country, so I have to find out which province each group of ‘municipalities with less than 2500 inhabitants’ belongs to. On the other hand, it is not necessary to look for the province of the remaining 100 municipalities, but the names are compatible with the database with all the municipalities and their population (except for two names, which are fixed). This allows them to be easily grouped by population and assigned a cusec to make them compatible with the rest of the database. In this source, it groups municipalities with less than 2500 inhabitants for each functional area. I have grouped them by province and will consider them as municipalities with less than 2000 inhabitants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Crear database a partir de informe</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>alquiler_vasco <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Municipio =</span> <span class="fu">c</span>(<span class="st">"Deba"</span>, <span class="st">"Eibar"</span>, <span class="st">"Elgoibar"</span>, <span class="st">"Ermua"</span>, <span class="st">"Mutriku"</span>, <span class="st">"Soraluze/Placencia de las Armas"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Agurain/Salvatierra"</span>, <span class="st">"Alegría-Dulantzi"</span>, <span class="st">"Iruña Oka/Iruña de Oca"</span>, <span class="st">"Vitoria-Gasteiz"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Balmaseda"</span>, <span class="st">"Güeñes"</span>, <span class="st">"Karrantza Harana/Valle de Carranza"</span>, <span class="st">"Sopuerta"</span>, <span class="st">"Zalla"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Beasain"</span>, <span class="st">"Lazkao"</span>, <span class="st">"Legazpi"</span>, <span class="st">"Ordizia"</span>, <span class="st">"Urretxu"</span>, <span class="st">"Zumarraga"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Abanto y Ciérvana-Abanto Zierbena"</span>, <span class="st">"Alonsotegi"</span>, <span class="st">"Arrigorriaga"</span>, <span class="st">"Barakaldo"</span>, <span class="st">"Basauri"</span>, <span class="st">"Berango"</span>, <span class="st">"Bilbao"</span>, <span class="st">"Derio"</span>, <span class="st">"Erandio"</span>, <span class="st">"Etxebarri"</span>, <span class="st">"Galdakao"</span>, <span class="st">"Getxo"</span>, <span class="st">"Gorliz"</span>, <span class="st">"Leioa"</span>, <span class="st">"Muskiz"</span>, <span class="st">"Ortuella"</span>, <span class="st">"Plentzia"</span>, <span class="st">"Portugalete"</span>, <span class="st">"Santurtzi"</span>, <span class="st">"Sestao"</span>, <span class="st">"Sondika"</span>, <span class="st">"Sopela"</span>, <span class="st">"Ugao-Miraballes"</span>, <span class="st">"Urduliz"</span>, <span class="st">"Valle de Trápaga-Trapagaran"</span>, <span class="st">"Zamudio"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Andoain"</span>, <span class="st">"Astigarraga"</span>, <span class="st">"Donostia / San Sebastián"</span>, <span class="st">"Errenteria"</span>, <span class="st">"Hernani"</span>, <span class="st">"Hondarribia"</span>, <span class="st">"Irun"</span>, <span class="st">"Lasarte-Oria"</span>, <span class="st">"Lezo"</span>, <span class="st">"Oiartzun"</span>, <span class="st">"Pasaia"</span>, <span class="st">"Urnieta"</span>, <span class="st">"Usurbil"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Abadiño"</span>, <span class="st">"Amorebieta-Etxano"</span>, <span class="st">"Berriz"</span>, <span class="st">"Durango"</span>, <span class="st">"Elorrio"</span>, <span class="st">"Iurreta"</span>, <span class="st">"Zaldibar"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Bermeo"</span>, <span class="st">"Gernika-Lumo"</span>, <span class="st">"Lekeitio"</span>, <span class="st">"Markina-Xemein"</span>, <span class="st">"Ondarroa"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Igorre"</span>, <span class="st">"Lemoa"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Oyón-Oion"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Amurrio"</span>, <span class="st">"Ayala/Aiara"</span>, <span class="st">"Laudio/Llodio"</span>, <span class="st">"Orozko"</span>, <span class="st">"Urduña/Orduña"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Aretxabaleta"</span>, <span class="st">"Arrasate/Mondragón"</span>, <span class="st">"Bergara"</span>, <span class="st">"Eskoriatza"</span>, <span class="st">"Oñati"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Bakio"</span>, <span class="st">"Mungia"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Ibarra"</span>, <span class="st">"Tolosa"</span>, <span class="st">"Villabona"</span>, <span class="st">"Zizurkil"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>, <span class="st">"Azkoitia"</span>, <span class="st">"Azpeitia"</span>, <span class="st">"Getaria"</span>, <span class="st">"Orio"</span>, <span class="st">"Zarautz"</span>, <span class="st">"Zestoa"</span>, <span class="st">"Zumaia"</span>, <span class="st">"Municipios de menos de 2.500 habitantes"</span>),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precio_medio_m2 =</span> <span class="fu">c</span>(<span class="fl">7.2</span>, <span class="fl">7.4</span>, <span class="fl">6.5</span>, <span class="fl">7.6</span>, <span class="fl">6.6</span>, <span class="fl">6.0</span>, <span class="fl">6.6</span>, <span class="fl">5.5</span>, <span class="fl">6.5</span>, <span class="cn">NA</span>, <span class="fl">8.5</span>, <span class="fl">5.2</span>, <span class="fl">6.9</span>, <span class="fl">7.4</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">6.9</span>, <span class="cn">NA</span>, <span class="fl">7.3</span>, <span class="fl">6.2</span>, <span class="fl">5.9</span>, <span class="fl">7.0</span>, <span class="fl">6.4</span>, <span class="fl">6.7</span>, <span class="fl">5.7</span>, <span class="fl">8.5</span>, <span class="fl">8.1</span>, <span class="fl">8.1</span>, <span class="fl">9.7</span>, <span class="fl">9.1</span>, <span class="fl">9.6</span>, <span class="fl">10.9</span>, <span class="fl">8.6</span>, <span class="fl">9.7</span>, <span class="fl">9.1</span>, <span class="fl">8.1</span>, <span class="fl">11.1</span>, <span class="fl">8.6</span>, <span class="fl">10.2</span>, <span class="fl">7.7</span>, <span class="fl">8.4</span>, <span class="fl">8.9</span>, <span class="fl">9.4</span>, <span class="fl">9.4</span>, <span class="fl">9.0</span>, <span class="fl">8.6</span>, <span class="fl">9.8</span>, <span class="fl">7.6</span>, <span class="fl">9.4</span>, <span class="fl">8.3</span>, <span class="fl">8.3</span>, <span class="fl">5.2</span>, <span class="fl">8.0</span>, <span class="fl">9.4</span>, <span class="fl">11.9</span>, <span class="fl">9.3</span>, <span class="fl">8.4</span>, <span class="fl">9.5</span>, <span class="fl">8.6</span>, <span class="fl">9.2</span>, <span class="fl">8.7</span>, <span class="fl">8.0</span>, <span class="fl">9.5</span>, <span class="fl">9.2</span>, <span class="fl">8.4</span>, <span class="fl">8.0</span>, <span class="fl">7.3</span>, <span class="fl">7.6</span>, <span class="fl">6.9</span>, <span class="fl">8.3</span>, <span class="fl">6.6</span>, <span class="fl">7.5</span>, <span class="fl">6.0</span>, <span class="cn">NA</span>, <span class="fl">6.3</span>, <span class="fl">6.5</span>, <span class="fl">6.9</span>, <span class="fl">5.9</span>, <span class="fl">6.9</span>, <span class="fl">6.0</span>, <span class="fl">5.9</span>, <span class="fl">7.1</span>, <span class="fl">5.9</span>, <span class="fl">4.8</span>, <span class="fl">4.8</span>, <span class="fl">6.0</span>, <span class="cn">NA</span>, <span class="fl">7.0</span>, <span class="fl">5.3</span>, <span class="fl">6.3</span>, <span class="fl">5.7</span>, <span class="fl">6.4</span>, <span class="fl">7.4</span>, <span class="fl">6.4</span>, <span class="fl">6.7</span>, <span class="fl">5.7</span>, <span class="fl">5.5</span>, <span class="fl">7.6</span>, <span class="fl">7.9</span>, <span class="fl">7.3</span>, <span class="fl">6.8</span>, <span class="fl">7.5</span>, <span class="fl">6.8</span>, <span class="fl">6.7</span>, <span class="fl">6.4</span>, <span class="fl">5.8</span>, <span class="fl">5.7</span>, <span class="fl">8.4</span>, <span class="fl">8.1</span>, <span class="fl">9.8</span>, <span class="fl">6.1</span>, <span class="fl">7.9</span>, <span class="fl">5.9</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">NOMBRE =</span> Municipio, <span class="at">PrecioAlquilerM2 =</span> Precio_medio_m2) <span class="sc">|&gt;</span>   <span class="fu">mutate</span>(<span class="at">NOMBRE =</span> <span class="fu">case_when</span>(</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    NOMBRE <span class="sc">==</span> <span class="st">"Soraluze/Placencia de las Armas"</span> <span class="sc">~</span> <span class="st">"Soraluze-Placencia de las Armas"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    NOMBRE <span class="sc">==</span> <span class="st">"Donostia / San Sebastián"</span> <span class="sc">~</span> <span class="st">"Donostia/San Sebastián"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> NOMBRE))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only the 'less than 2500 inhabitants' and filter NA</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>municipios_faltantes <span class="ot">&lt;-</span> alquiler_vasco <span class="sc">|&gt;</span> </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(poblacion_mun21, <span class="at">by =</span> <span class="st">"NOMBRE"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(PrecioAlquilerM2))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add provinces for which they belong to </span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>municipios_faltantes<span class="sc">$</span>PROV_LITERAL <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Araba/Álava"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Gipuzkoa"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Araba/Álava"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Gipuzkoa"</span>, <span class="st">"Bizkaia"</span>, <span class="st">"Gipuzkoa"</span>, <span class="st">"Gipuzkoa"</span>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Average by province</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>municipios_faltantes <span class="ot">&lt;-</span> municipios_faltantes <span class="sc">|&gt;</span> </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(PROV_LITERAL) <span class="sc">|&gt;</span> </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PrecioAlquilerM2 =</span><span class="fu">round</span>(<span class="fu">mean</span>(PrecioAlquilerM2), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cusec to municipalities with less than 2500 inhabitants</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>municipios_faltantes<span class="sc">$</span>cusec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"01991"</span>, <span class="st">"48991"</span>, <span class="st">"20991"</span>)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>municipios_faltantes <span class="ot">&lt;-</span> municipios_faltantes <span class="sc">|&gt;</span> </span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PROV_LITERAL)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cusec to all Basque municipalities</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>alquiler_vasco <span class="ot">&lt;-</span> alquiler_vasco <span class="sc">|&gt;</span> </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(poblacion_mun21, NOMBRE, cusec), <span class="at">by =</span> <span class="st">"NOMBRE"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(PrecioAlquilerM2)) <span class="sc">|&gt;</span> </span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>NOMBRE)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Join together both tables</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>alquiler_vasco <span class="ot">&lt;-</span> <span class="fu">rbind</span>(alquiler_vasco, municipios_faltantes)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Group small municipalities</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>alquiler_vasco <span class="ot">&lt;-</span> alquiler_vasco <span class="sc">|&gt;</span> </span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cusec_rural_2021, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cusec"</span> <span class="ot">=</span> <span class="st">"cusec_original"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cusec =</span> <span class="fu">coalesce</span>(cusec.y, cusec)) <span class="sc">|&gt;</span> </span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cusec.y) <span class="sc">|&gt;</span> </span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cusec) <span class="sc">|&gt;</span> <span class="co"># Group all small mun together by province </span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">PrecioAlquilerM2 =</span> <span class="fu">round</span>(<span class="fu">mean</span>(PrecioAlquilerM2), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(cusec, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Join data of the whole country with basque data</span></span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>alq <span class="ot">&lt;-</span> <span class="fu">rbind</span>(alquiler_vasco, alq)</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(alq, <span class="at">by =</span> <span class="st">"cusec"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="price-of-mortgages-per-province" class="level2">
<h2 class="anchored" data-anchor-id="price-of-mortgages-per-province">Price of mortgages per province</h2>
<p>Average mortgage price in 2021 per province, in thousand of euros. Only dwellings, no plots of land etc.</p>
<p>https://www.ine.es/jaxiT3/Tabla.htm?t=3200&amp;L=0</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hipotecas 2021</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>hipotecas <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Hipotecas/hipotecas.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`
• `` -&gt; `...8`
• `` -&gt; `...9`
• `` -&gt; `...10`
• `` -&gt; `...11`
• `` -&gt; `...12`
• `` -&gt; `...15`
• `` -&gt; `...16`
• `` -&gt; `...17`
• `` -&gt; `...18`
• `` -&gt; `...19`
• `` -&gt; `...20`
• `` -&gt; `...21`
• `` -&gt; `...22`
• `` -&gt; `...23`
• `` -&gt; `...24`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>hipotecas <span class="ot">&lt;-</span> hipotecas <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(num_hipotecas2021M12<span class="sc">:</span><span class="fu">last_col</span>(), as.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NumHipotecas2021 =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., num_hipotecas2021M12<span class="sc">:</span>num_hipotecas2021M01), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ImporteHipotecas2021 =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., importe_2021M12<span class="sc">:</span>importe_2021M01), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">PrecioHipoteca2021Prov =</span> <span class="fu">round</span>(ImporteHipotecas2021 <span class="sc">/</span> NumHipotecas2021 <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PROV_LITERAL, NumHipotecas2021, ImporteHipotecas2021, PrecioHipoteca2021Prov) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, PROV_LITERAL),</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">PROV_LITERAL =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">""</span>, PROV_LITERAL) <span class="sc">|&gt;</span> <span class="fu">trimws</span>())  <span class="sc">|&gt;</span> </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, PrecioHipoteca2021Prov)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Hipotecas 2011</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>hipotecas2011 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Hipotecas/hipotecas2011.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`
• `` -&gt; `...8`
• `` -&gt; `...9`
• `` -&gt; `...10`
• `` -&gt; `...11`
• `` -&gt; `...12`
• `` -&gt; `...15`
• `` -&gt; `...16`
• `` -&gt; `...17`
• `` -&gt; `...18`
• `` -&gt; `...19`
• `` -&gt; `...20`
• `` -&gt; `...21`
• `` -&gt; `...22`
• `` -&gt; `...23`
• `` -&gt; `...24`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>hipotecas2011 <span class="ot">&lt;-</span> hipotecas2011 <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(num_hipotecas2011M12<span class="sc">:</span><span class="fu">last_col</span>(), as.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NumHipotecas2011 =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., num_hipotecas2011M12<span class="sc">:</span>num_hipotecas2011M01), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ImporteHipotecas2011 =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., importe_2011M12<span class="sc">:</span>importe_2011M01), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">PrecioHipoteca2011Prov =</span> <span class="fu">round</span>(ImporteHipotecas2011 <span class="sc">/</span> NumHipotecas2011 <span class="sc">*</span> <span class="dv">1000</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PROV_LITERAL, NumHipotecas2011, ImporteHipotecas2011, PrecioHipoteca2011Prov) <span class="sc">%&gt;%</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">5</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CPRO =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, PROV_LITERAL),</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">PROV_LITERAL =</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d"</span>, <span class="st">""</span>, PROV_LITERAL) <span class="sc">|&gt;</span> <span class="fu">trimws</span>())  <span class="sc">|&gt;</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CPRO, PrecioHipoteca2011Prov)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Join both years</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>hipotecas <span class="ot">&lt;-</span> hipotecas <span class="sc">|&gt;</span> </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hipotecas2011, <span class="at">by =</span> <span class="st">"CPRO"</span>)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create difference</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>hipotecas <span class="ot">&lt;-</span> hipotecas <span class="sc">|&gt;</span> </span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DifPrecioHipotecaProv =</span> ((PrecioHipoteca2021Prov <span class="sc">-</span> PrecioHipoteca2011Prov) <span class="sc">/</span> PrecioHipoteca2011Prov) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span>     </span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DifPrecioHipotecaProv =</span> <span class="fu">round</span>(DifPrecioHipotecaProv, <span class="dv">2</span>))</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with main database</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hipotecas, <span class="at">by =</span> <span class="st">"CPRO"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="youth-unemployement" class="level2">
<h2 class="anchored" data-anchor-id="youth-unemployement">Youth Unemployement</h2>
<p>Youth unemployement rate in young people under 25 years old per CCAA en 2021 y 2011</p>
<p>https://www.ine.es/jaxiT3/Tabla.htm?t=4247&amp;L=0</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In 2021</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>paro2021 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Paro juvenil/paroccaa2021.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>paro2021 <span class="ot">&lt;-</span> paro2021 <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">7</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CCAA =</span> <span class="dv">1</span>, <span class="at">ParoJuvenil2021 =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ParoJuvenil2021 =</span> <span class="fu">as.numeric</span>(ParoJuvenil2021),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">CCAA =</span> <span class="fu">gsub</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s*"</span>, <span class="st">""</span>, CCAA))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>paro2021 <span class="ot">&lt;-</span> paro2021 <span class="sc">|&gt;</span>    </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CCAA =</span> <span class="fu">case_when</span>(</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Asturias, Principado de"</span> <span class="sc">~</span> <span class="st">"Asturias"</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Balears, Illes"</span> <span class="sc">~</span> <span class="st">"Islas Baleares"</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Castilla - La Mancha"</span> <span class="sc">~</span> <span class="st">"Castilla-La Mancha"</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Comunitat Valenciana"</span> <span class="sc">~</span> <span class="st">"Comunidad Valenciana"</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Madrid, Comunidad de"</span> <span class="sc">~</span> <span class="st">"Comunidad de Madrid"</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Murcia, Región de"</span> <span class="sc">~</span> <span class="st">"Comunidad de Murcia"</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Navarra, Comunidad Foral de"</span> <span class="sc">~</span> <span class="st">"Comunidad Foral de Navarra"</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Rioja, La"</span> <span class="sc">~</span> <span class="st">"La Rioja"</span>,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> CCAA))</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># In 2011</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>paro2011 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Paro juvenil/paroccaa2011.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...2`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>paro2011 <span class="ot">&lt;-</span> paro2011 <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, (<span class="fu">n</span>() <span class="sc">-</span> <span class="dv">7</span>)<span class="sc">:</span><span class="fu">n</span>())) <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CCAA =</span> <span class="dv">1</span>, <span class="at">ParoJuvenil2011 =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ParoJuvenil2011 =</span> <span class="fu">as.numeric</span>(ParoJuvenil2011),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">CCAA =</span> <span class="fu">gsub</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s*"</span>, <span class="st">""</span>, CCAA))</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>paro2011 <span class="ot">&lt;-</span> paro2011 <span class="sc">|&gt;</span>    </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CCAA =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Asturias, Principado de"</span> <span class="sc">~</span> <span class="st">"Asturias"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Balears, Illes"</span> <span class="sc">~</span> <span class="st">"Islas Baleares"</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Castilla - La Mancha"</span> <span class="sc">~</span> <span class="st">"Castilla-La Mancha"</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Comunitat Valenciana"</span> <span class="sc">~</span> <span class="st">"Comunidad Valenciana"</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Madrid, Comunidad de"</span> <span class="sc">~</span> <span class="st">"Comunidad de Madrid"</span>,</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Murcia, Región de"</span> <span class="sc">~</span> <span class="st">"Comunidad de Murcia"</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Navarra, Comunidad Foral de"</span> <span class="sc">~</span> <span class="st">"Comunidad Foral de Navarra"</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Rioja, La"</span> <span class="sc">~</span> <span class="st">"La Rioja"</span>,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> CCAA))</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>paro <span class="ot">&lt;-</span> paro2011 <span class="sc">|&gt;</span> </span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(paro2021, <span class="at">by =</span> <span class="st">"CCAA"</span>)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>paro <span class="ot">&lt;-</span> paro <span class="sc">|&gt;</span> </span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ParoJuvenilDif =</span> ParoJuvenil2021 <span class="sc">-</span> ParoJuvenil2011)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with municipalities</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(paro, <span class="at">by =</span> <span class="st">"CCAA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="subsidized-housing" class="level2">
<h2 class="anchored" data-anchor-id="subsidized-housing">Subsidized housing</h2>
<p>Number of provisional califications of subsidized housing per CCAA. I multiply by 10 to get the total number of dwellings since the microdata is a sample of 10%.</p>
<p>The difference variable isn’t the percentage of how much the the amount of subsidized housing has lowered in itself, but how much has loweered the percentage of subsidized housing regarding the total in 2011 in comparison to 2021.</p>
<p>https://apps.fomento.gob.es/BoletinOnline2/?nivel=2&amp;orden=34000000</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2011</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>protegida2011 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Vivienda protegida/viviendaprotegida.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"2011"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>protegida2011 <span class="ot">&lt;-</span> protegida2011 <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">11</span><span class="sc">:</span>(<span class="fu">nrow</span>(protegida2011) <span class="sc">-</span> <span class="dv">8</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CCAA =</span> ...<span class="dv">1</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaTotal2011 =</span> ...<span class="dv">2</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaPropiedad2011 =</span> ...<span class="dv">3</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaAlquiler2011 =</span> ...<span class="dv">4</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaAutopromocion2011 =</span> ...<span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>CCAA, as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CCAA =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Asturias (Principado de )"</span> <span class="sc">~</span> <span class="st">"Asturias"</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Balears (Illes)"</span> <span class="sc">~</span> <span class="st">"Islas Baleares"</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Comunitat Valenciana"</span> <span class="sc">~</span> <span class="st">"Comunidad Valenciana"</span>,</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Madrid (Comunidad de) (1)"</span> <span class="sc">~</span> <span class="st">"Comunidad de Madrid"</span>,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Murcia (Región de)"</span> <span class="sc">~</span> <span class="st">"Comunidad de Murcia"</span>,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Navarra (Comunidad Foral de)"</span> <span class="sc">~</span> <span class="st">"Comunidad Foral de Navarra"</span>,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Rioja (La)"</span> <span class="sc">~</span> <span class="st">"La Rioja"</span>,</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> CCAA))</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2021  </span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>protegida2021 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"DataFiles/Vivienda protegida/viviendaprotegida.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"2021"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>protegida2021 <span class="ot">&lt;-</span> protegida2021 <span class="sc">|&gt;</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">11</span><span class="sc">:</span>(<span class="fu">nrow</span>(protegida2021) <span class="sc">-</span> <span class="dv">8</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CCAA =</span> ...<span class="dv">1</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaTotal2021 =</span> ...<span class="dv">2</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaPropiedad2021 =</span> ...<span class="dv">3</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaAlquiler2021 =</span> ...<span class="dv">4</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ProtegidaAutopromocion2021 =</span> ...<span class="dv">5</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>CCAA, as.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CCAA =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Asturias (Principado de )"</span> <span class="sc">~</span> <span class="st">"Asturias"</span>,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Balears (Illes)"</span> <span class="sc">~</span> <span class="st">"Islas Baleares"</span>,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Comunitat Valenciana"</span> <span class="sc">~</span> <span class="st">"Comunidad Valenciana"</span>,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Madrid (Comunidad de)"</span> <span class="sc">~</span> <span class="st">"Comunidad de Madrid"</span>,</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Murcia (Región de)"</span> <span class="sc">~</span> <span class="st">"Comunidad de Murcia"</span>,</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Navarra (Comunidad Foral de)"</span> <span class="sc">~</span> <span class="st">"Comunidad Foral de Navarra"</span>,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    CCAA <span class="sc">==</span> <span class="st">"Rioja (La)"</span> <span class="sc">~</span> <span class="st">"La Rioja"</span>,</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> CCAA))</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage of subsidized housing regarding the total in 2011 per CCAA</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>nviviendas2011 <span class="ot">&lt;-</span> viviendas2011 <span class="sc">|&gt;</span> </span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ccaas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CPRO"</span> <span class="ot">=</span> <span class="st">"CodigoProvincia"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CCAA) <span class="sc">|&gt;</span> </span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CCAA) <span class="sc">|&gt;</span> </span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasTotales2011 =</span> <span class="fu">n</span>() <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CCAA, ViviendasTotales2011) <span class="sc">|&gt;</span> </span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(CCAA, <span class="at">.keep_all =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(mutate(viviendas2011, CPRO = str_pad(CPRO, width = 2, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 23100 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>protegida2011 <span class="ot">&lt;-</span> protegida2011 <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nviviendas2011, <span class="at">by =</span> <span class="st">"CCAA"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>protegida2011 <span class="ot">&lt;-</span> protegida2011 <span class="sc">|&gt;</span> </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeProtegidas2011 =</span> <span class="fu">round</span>((ProtegidaTotal2011 <span class="sc">/</span> ViviendasTotales2011) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(PorcentajeProtegidas2011, CCAA)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage of subsidized housing regarding the total in 2021 per CCAA</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>nviviendas2021 <span class="ot">&lt;-</span> viviendas2021 <span class="sc">|&gt;</span> </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">CPRO =</span> <span class="fu">str_pad</span>(CPRO, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ccaas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CPRO"</span> <span class="ot">=</span> <span class="st">"CodigoProvincia"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CCAA) <span class="sc">|&gt;</span> </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CCAA) <span class="sc">|&gt;</span> </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ViviendasTotales2021 =</span> <span class="fu">n</span>() <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CCAA, ViviendasTotales2021) <span class="sc">|&gt;</span> </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(CCAA, <span class="at">.keep_all =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(mutate(viviendas2021, CPRO = str_pad(CPRO, width = 2, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 69 of `x` matches multiple rows in `y`.
ℹ Row 28 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>protegida2021 <span class="ot">&lt;-</span> protegida2021 <span class="sc">|&gt;</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nviviendas2021, <span class="at">by =</span> <span class="st">"CCAA"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>protegida2021 <span class="ot">&lt;-</span> protegida2021 <span class="sc">|&gt;</span> </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">PorcentajeProtegidas2021 =</span> <span class="fu">round</span>((ProtegidaTotal2021 <span class="sc">/</span> ViviendasTotales2021) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PorcentajeProtegidas2021, CCAA)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Join both years</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>protegida <span class="ot">&lt;-</span> protegida2011 <span class="sc">|&gt;</span> </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(protegida2021, <span class="at">by =</span> <span class="st">"CCAA"</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>protegida <span class="ot">&lt;-</span> protegida <span class="sc">|&gt;</span> </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ProtegidaDif =</span> PorcentajeProtegidas2021 <span class="sc">-</span> PorcentajeProtegidas2011) </span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Join with main database</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(protegida, <span class="at">by =</span> <span class="st">"CCAA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="last-fixes" class="level1">
<h1>Last fixes</h1>
<p>I remove some municipalities for lack of data and I check in which rows there are NA. Only in 8 rows, all because of data for rental square meter price missing. The most problematic thing is that all the municipalities of Navarra are missing, perhaps making imputation less accurate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MUN_LITERAL <span class="sc">!=</span> <span class="st">"Baena"</span>) <span class="sc">|&gt;</span> <span class="co"># Remove because in 2021 it has more than 20k inhabitants and I don't have data from 2011</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cusec <span class="sc">!=</span> <span class="dv">47994</span>) <span class="sc">|&gt;</span> <span class="co"># No municipalities from 10k to 20k inhabitants in Valladolid </span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MUN_LITERAL <span class="sc">!=</span> <span class="st">"Calatayud"</span>) <span class="sc">|&gt;</span>  <span class="co"># In 2021 it has less than 20k inhabitants</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MUN_LITERAL <span class="sc">!=</span> <span class="st">"Barañain"</span>) <span class="co"># En 2021 it has less than  20k inhabitants</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputing-missing-values" class="level1">
<h1>Imputing missing values</h1>
<p>I impute the missing values of the variable PrecioAlquilerM2 using the pmm method because it seems to be the most accurate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>municipiosm <span class="ot">&lt;-</span> municipios </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipiosm</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>municipiosr <span class="ot">&lt;-</span> municipios</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>data_imputed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cusec =</span> municipiosr<span class="sc">$</span>cusec,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> municipiosr<span class="sc">$</span>PrecioAlquilerM2,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">imputed_pmm =</span> <span class="fu">complete</span>(<span class="fu">mice</span>(municipiosr, <span class="at">m=</span><span class="dv">10</span>, <span class="at">method =</span> <span class="st">"pmm"</span>, <span class="at">seed=</span><span class="dv">123</span>))<span class="sc">$</span>PrecioAlquilerM2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 iter imp variable
  1   1  PrecioAlquilerM2*
  1   2  PrecioAlquilerM2*
  1   3  PrecioAlquilerM2*
  1   4  PrecioAlquilerM2*
  1   5  PrecioAlquilerM2*
  1   6  PrecioAlquilerM2*
  1   7  PrecioAlquilerM2*
  1   8  PrecioAlquilerM2*
  1   9  PrecioAlquilerM2*
  1   10  PrecioAlquilerM2*
  2   1  PrecioAlquilerM2*
  2   2  PrecioAlquilerM2*
  2   3  PrecioAlquilerM2*
  2   4  PrecioAlquilerM2*
  2   5  PrecioAlquilerM2*
  2   6  PrecioAlquilerM2*
  2   7  PrecioAlquilerM2*
  2   8  PrecioAlquilerM2*
  2   9  PrecioAlquilerM2*
  2   10  PrecioAlquilerM2*
  3   1  PrecioAlquilerM2*
  3   2  PrecioAlquilerM2*
  3   3  PrecioAlquilerM2*
  3   4  PrecioAlquilerM2*
  3   5  PrecioAlquilerM2*
  3   6  PrecioAlquilerM2*
  3   7  PrecioAlquilerM2*
  3   8  PrecioAlquilerM2*
  3   9  PrecioAlquilerM2*
  3   10  PrecioAlquilerM2*
  4   1  PrecioAlquilerM2*
  4   2  PrecioAlquilerM2*
  4   3  PrecioAlquilerM2*
  4   4  PrecioAlquilerM2*
  4   5  PrecioAlquilerM2*
  4   6  PrecioAlquilerM2*
  4   7  PrecioAlquilerM2*
  4   8  PrecioAlquilerM2*
  4   9  PrecioAlquilerM2*
  4   10  PrecioAlquilerM2*
  5   1  PrecioAlquilerM2*
  5   2  PrecioAlquilerM2*
  5   3  PrecioAlquilerM2*
  5   4  PrecioAlquilerM2*
  5   5  PrecioAlquilerM2*
  5   6  PrecioAlquilerM2*
  5   7  PrecioAlquilerM2*
  5   8  PrecioAlquilerM2*
  5   9  PrecioAlquilerM2*
  5   10  PrecioAlquilerM2*</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Number of logged events: 106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>municipios_r <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_all</span>(<span class="fu">any_vars</span>(<span class="fu">is.na</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(cusec)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>data_imputed_filtrado <span class="ot">&lt;-</span> data_imputed <span class="sc">|&gt;</span> </span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="fu">select</span>(municipios_r, cusec), <span class="at">by =</span> <span class="st">"cusec"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">PrecioAlquilerM2 =</span> imputed_pmm) <span class="sc">|&gt;</span> </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cusec, PrecioAlquilerM2)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>municipios <span class="ot">&lt;-</span> municipios <span class="sc">|&gt;</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PrecioAlquilerM2=</span> <span class="fu">case_when</span>(</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">11991</span> <span class="sc">~</span> <span class="fl">8.6</span>,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">30991</span> <span class="sc">~</span> <span class="fl">9.3</span>,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">31991</span> <span class="sc">~</span> <span class="fl">8.6</span>,</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">31992</span> <span class="sc">~</span> <span class="fl">10.9</span>,</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">31993</span> <span class="sc">~</span> <span class="fl">8.6</span>,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">31994</span> <span class="sc">~</span> <span class="fl">11.9</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">31201</span> <span class="sc">~</span> <span class="fl">8.6</span>,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>      cusec <span class="sc">==</span> <span class="dv">31232</span> <span class="sc">~</span> <span class="fl">11.9</span>,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> PrecioAlquilerM2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="save-finished-database" class="level1">
<h1>Save finished database</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#write.xlsx(municipios, "municipios.xlsx")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>